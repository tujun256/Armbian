name: Build Armbian Stable (boca-tcn200)

on:
  workflow_dispatch:  # 手动触发编译（推荐）
  # schedule:
  #   - cron: '0 0 * * 0'  # 可选：每周日凌晨触发，注释掉则仅手动触发

jobs:
  # Job 1: 编译 legacy 分支（5.10内核）
  build-legacy:
    runs-on: ubuntu-22.04
    permissions:
      contents: write
    steps:
      - name: Checkout Armbian Build Code
        uses: actions/checkout@v4
        with:
          repository: stevenliuit/armbian-build  # 核心修改：指向目标仓库
          path: armbian-build
          fetch-depth: 1

      - name: Prepare Build Environment
        run: |
          sudo apt update && sudo apt install -y git curl wget build-essential libncurses5-dev libssl-dev unzip zip
          cd armbian-build
          ./scripts/prepare-host.sh  # 安装 Armbian 编译依赖

      - name: Build Armbian (boca-tcn200 legacy/5.10)
        run: |
          cd armbian-build
          # 核心编译参数：指定板型、内核分支、系统类型（可根据需求调整）
          ./compile.sh \
            BOARD=boca-tcn200 \
            BRANCH=legacy \  # 指定 legacy 分支（5.10内核）
            RELEASE=bookworm \  # 系统版本，可选 bullseye/bookworm
            BUILD_MINIMAL=no \  # 不编译最小系统
            BUILD_DESKTOP=yes \  # 编译桌面版（匹配板型配置的 FULL_DESKTOP="yes"）
            KERNEL_ONLY=no \
            KERNEL_CONFIGURE=no \
            CLEAN_LEVEL=make clean \
            USERPATCHES_PATH=userpatches  # 加载板型专属补丁

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: armbian-boca-tcn200-legacy-5.10
          path: armbian-build/output/images/*.img*  # 上传编译好的镜像文件

  # Job 2: 编译 vendor 分支（6.1内核）
  build-vendor:
    runs-on: ubuntu-22.04
    permissions:
      contents: write
    steps:
      - name: Checkout Armbian Build Code
        uses: actions/checkout@v4
        with:
          repository: stevenliuit/armbian-build  # 核心修改：指向目标仓库
          path: armbian-build
          fetch-depth: 1

      - name: Prepare Build Environment
        run: |
          sudo apt update && sudo apt install -y git curl wget build-essential libncurses5-dev libssl-dev unzip zip
          cd armbian-build
          ./scripts/prepare-host.sh

      - name: Build Armbian (boca-tcn200 vendor/6.1)
        run: |
          cd armbian-build
          # 核心编译参数：仅修改 BRANCH 为 vendor
          ./compile.sh \
            BOARD=boca-tcn200 \
            BRANCH=vendor \  # 指定 vendor 分支（6.1内核）
            RELEASE=bookworm \
            BUILD_MINIMAL=no \
            BUILD_DESKTOP=yes \
            KERNEL_ONLY=no \
            KERNEL_CONFIGURE=no \
            CLEAN_LEVEL=make clean \
            USERPATCHES_PATH=userpatches

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: armbian-boca-tcn200-vendor-6.1
          path: armbian-build/output/images/*.img*
