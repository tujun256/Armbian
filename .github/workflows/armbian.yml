name: Build Armbian Firmware

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:
    inputs:
      board:
        description: 'Target board (e.g., orangepi5, rock-5b, radxa-zero3)'
        required: true
        default: 'orangepi5'
      release:
        description: 'Target release (e.g., jammy, bookworm, noble)'
        required: true
        default: 'bookworm'
      build_desktop:
        description: 'Build desktop image'
        required: true
        default: 'no'
        type: choice
        options:
          - 'no'
          - 'yes'
          - 'minimal'

env:
  # 编译配置
  BOARD: ${{ github.event.inputs.board || 'orangepi5' }}
  RELEASE: ${{ github.event.inputs.release || 'bookworm' }}
  BUILD_DESKTOP: ${{ github.event.inputs.build_desktop || 'no' }}

jobs:
  build:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: false
      matrix:
        branch: [legacy, vendor]
    
    steps:
      - name: Maximize build space
        uses: easimon/maximize-build-space@master
        with:
          root-reserve-mb: 8192
          swap-size-mb: 1024
          remove-dotnet: 'true'
          remove-android: 'true'
          remove-haskell: 'true'
          remove-codeql: 'true'
          remove-docker-images: 'true'
      
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          repository: alerice/armbian-build
          fetch-depth: 0
          submodules: recursive
      
      - name: Show
